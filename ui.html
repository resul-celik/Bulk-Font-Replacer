<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <title>Replace Fonts</title>
    <style>
      :root {
        --font: "Outfit", sans-serif;
        --primary-color: #f9dec9;
        --secondary-color: #050517;
        --tertiary-color: #abd1b5;
      }

      /* width */
      ::-webkit-scrollbar {
        width: 7px;
      }

      /* Track */
      ::-webkit-scrollbar-track {
        background: var(--primary-color);
      }

      /* Handle */
      ::-webkit-scrollbar-thumb {
        background: var(--secondary-color);
      }

      body {
        width: 100%;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
          sans-serif;
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0px;
        position: relative;
        width: 100vw;
        height: 100vh;
        inset: 0;
        background: var(--primary-color);
        border-radius: 0px;
        box-sizing: border-box;
      }

      .body {
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 0px 95px;
        gap: 10px;
        width: 100%;
        height: auto;
        flex: none;
        order: 0;
        align-self: stretch;
        flex-grow: 1;
        font-size: 25px;
        text-align: center;
        box-sizing: border-box;
        font-family: var(--font);
        font-weight: 400;
      }

      .icon {
        width: 24px;
        height: 24px;
      }

      .icon path {
        stroke: var(--secondary-color);
      }

      .footer,
      .fonts-footer {
        display: none;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        padding: 20px;
        gap: 6px;
        width: 100%;
        height: auto;
        flex: none;
        order: 1;
        align-self: stretch;
        box-sizing: border-box;
        font-size: 14px;
        font-family: var(--font);
        border-top: 1px solid var(--secondary-color);
      }

      .fonts-footer {
        padding: 0 0 0 15px;
      }

      .footer-left {
        display: flex;
        flex-direction: row;
        align-items: baseline;
        padding: 0px;
        gap: 3px;
        flex-grow: 1;
        box-sizing: border-box;
      }

      .footer-right {
        display: flex;
        flex-direction: row;
        justify-content: flex-start;
        align-items: center;
        padding: 0px;
        gap: 6px;
      }

      .footer-right a {
        color: var(--secondary-color);
        font-family: var(--font);
        text-decoration: none;
      }

      .footer-right a:hover {
        color: var(--secondary-color);
        font-family: var(--font);
        text-decoration: underline;
      }

      .selected-fonts {
        display: none;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        width: 100%;
        align-self: stretch;
        flex-grow: 1;
        box-sizing: border-box;
        overflow-y: auto;
      }

      .selected-font {
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: 0px 0px 0px 15px;
        gap: 20px;
        width: 100%;
        height: auto;
        border-bottom: 1px solid var(--secondary-color);
        flex: none;
        align-self: stretch;
        flex-grow: 0;
        box-sizing: border-box;
        font-family: var(--font);
        font-weight: 400;
      }

      .current-font,
      .new-font {
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: 0px;
        gap: 6px;
        flex-grow: 0;
      }

      .new-font {
        pointer-events: none;
      }

      .go-to {
        cursor: pointer;
      }

      .font-name {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        gap: 5px;
        pointer-events: none;
        font-size: 18px;
        font-weight: 400;
      }

      .font-style {
        font-size: 12px;
        padding: 3px 6px;
        background-color: var(--tertiary-color);
        pointer-events: none;
        font-weight: 400;
        letter-spacing: 0.2px;
      }

      .arrow-wrapper {
        position: relative;
        height: 0;
        border-bottom: 1px solid var(--secondary-color);
        flex-grow: 1;
      }

      .arrow {
        position: absolute;
        width: 12px;
        height: 12px;
        right: 1px;
        top: -6px;
        transform: rotate(-45deg);
        background-color: transparent;
        border-right: 1px solid var(--secondary-color);
        border-bottom: 1px solid var(--secondary-color);
      }

      .dropdown-text {
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: 15px;
        gap: 12px;
        background: var(--primary-color);
        border-left: 1px solid var(--secondary-color);
        flex-grow: 0;
        box-sizing: border-box;
        cursor: pointer;
        user-select: none;
        font-size: 18px;
      }

      .dropdown-selected {
        background: var(--tertiary-color);
      }

      .dropdown-content {
        width: 100vw;
        height: 100vh;
        display: none;
        justify-content: flex-start;
        align-items: flex-start;
        flex-direction: column;
        position: absolute;
        inset: 0;
        background-color: var(--primary-color);
        padding: 0;
        box-sizing: border-box;
        z-index: 99;
      }

      .content-head {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px;
        gap: 15px;
        width: 100%;
        align-self: stretch;
        flex-grow: 0;
        box-sizing: border-box;
      }

      .content-actions {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 0px;
        gap: 5px;
        width: 100%;
        align-self: stretch;
        flex-grow: 0;
      }

      .dropdown-title {
        font-family: var(--font);
        font-weight: 400;
        font-size: 14px;
      }

      .dropdown-title b {
        font-weight: 600;
      }

      .search-wrapper {
        width: 100%;
        position: relative;
      }

      .search {
        display: block;
        padding: 12px 11px;
        width: 100%;
        background-color: var(--primary-color);
        border: 1px solid var(--secondary-color);
        color: var(--secondary-color);
        outline: none;
        align-self: stretch;
        flex-grow: 0;
        box-sizing: border-box;
        font-family: var(--font);
        font-weight: 400;
        font-size: 14px;
      }

      .search::placeholder {
        color: var(--secondary-color);
      }

      .search-icon {
        position: absolute;
        right: 10px;
        top: calc(50% - 13px);
        z-index: 8;
      }

      .options {
        width: 100%;
        display: flex;
        justify-content: flex-start;
        align-items: flex-start;
        flex-direction: column;
        flex-grow: 1;
        overflow-y: auto;
      }

      .option {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        gap: 20px;
        width: 100%;
        border-bottom: 1px solid var(--secondary-color);
        align-self: stretch;
        flex-grow: 0;
        box-sizing: border-box;
        user-select: none;
        cursor: pointer;
      }

      .option .checkmark-icon {
        display: none;
      }

      .current-option {
        background-color: var(--tertiary-color);
      }

      .current-option .checkmark-icon {
        pointer-events: none;
        display: block;
      }

      .first-option {
        border-top: 1px solid var(--secondary-color);
      }

      .option:hover {
        background-color: var(--tertiary-color);
        box-sizing: border-box;
      }

      .option:hover .font-style,
      .current-option .font-style,
      .dropdown-selected .font-style {
        background-color: var(--primary-color);
      }

      .active {
        display: flex;
      }

      #replace-button {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        padding: 20px 40px;
        gap: 10px;
        background: var(--secondary-color);
        color: var(--primary-color);
        flex-grow: 0;
        box-sizing: border-box;
        font-family: var(--font);
        font-weight: 400;
        font-size: 16px;
        border: none;
        border-left: 1px solid var(--secondary-color);
        outline: none;
        cursor: pointer;
        user-select: none;
      }

      #replace-button:hover {
        background-color: var(--primary-color);
        border-left: 1px solid var(--secondary-color);
        color: var(--secondary-color);
      }

      .information {
        font-family: var(--font);
        font-weight: 400;
        font-size: 12px;
        color: var(--secondary-color);
      }

      .selected {
        display: flex;
      }

      .close-icon {
        cursor: pointer;
      }

      .image {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        padding: 0px 0px 0px 13px;
        gap: 10px;
        flex-grow: 0;
      }

      .image img {
        width: 130px;
        height: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="body selected">
        <div class="image">
          <img
            src="data:image/svg+xml,%3Csvg width='132' height='85' viewBox='0 0 132 85' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect x='5.5' y='6' width='105' height='55' fill='%23F9DEC9'/%3E%3Crect x='5.5' y='6' width='105' height='55' stroke='%23050517'/%3E%3Crect x='5.5' y='6' width='79.479' height='43.4139' fill='%23F9DEC9' stroke='%23050517'/%3E%3Crect x='78.5225' y='28.519' width='31.9775' height='32.4809' fill='%23F9DEC9' stroke='%23050517'/%3E%3Crect x='0.555664' y='1.05566' width='9.88867' height='9.88867' fill='%23F9DEC9' stroke='%23050517'/%3E%3Crect x='0.555664' y='56.1372' width='9.88867' height='9.88867' fill='%23F9DEC9' stroke='%23050517'/%3E%3Crect x='105.611' y='1.05566' width='9.88867' height='9.88867' fill='%23F9DEC9' stroke='%23050517'/%3E%3Crect x='105.611' y='56.0557' width='9.88867' height='9.88867' fill='%23F9DEC9' stroke='%23050517'/%3E%3Cpath d='M16.7677 35.723V16.286H18.2782V35.723H16.7677ZM17.7367 35.723V34.355H28.7092V35.723H17.7367ZM37.155 36.008C35.882 36.008 34.7325 35.704 33.7065 35.096C32.6995 34.488 31.9015 33.671 31.3125 32.645C30.7235 31.6 30.429 30.422 30.429 29.111C30.429 27.819 30.7235 26.6505 31.3125 25.6055C31.9015 24.5605 32.6995 23.734 33.7065 23.126C34.7135 22.499 35.844 22.1855 37.098 22.1855C38.124 22.1855 39.036 22.385 39.834 22.784C40.651 23.164 41.316 23.7055 41.829 24.4085C42.361 25.1115 42.703 25.9475 42.855 26.9165V31.2485C42.684 32.2175 42.3325 33.063 41.8005 33.785C41.2875 34.488 40.632 35.039 39.834 35.438C39.055 35.818 38.162 36.008 37.155 36.008ZM37.3545 34.64C38.8745 34.64 40.081 34.1365 40.974 33.1295C41.886 32.1035 42.342 30.764 42.342 29.111C42.342 27.99 42.133 27.021 41.715 26.204C41.316 25.368 40.7365 24.722 39.9765 24.266C39.2165 23.791 38.333 23.5535 37.326 23.5535C36.281 23.5535 35.35 23.791 34.533 24.266C33.735 24.741 33.0985 25.3965 32.6235 26.2325C32.1675 27.0685 31.9395 28.0185 31.9395 29.0825C31.9395 30.1655 32.1675 31.125 32.6235 31.961C33.0985 32.797 33.7445 33.4525 34.5615 33.9275C35.3785 34.4025 36.3095 34.64 37.3545 34.64ZM42.285 35.723V32.1605L42.5985 28.9115L42.285 25.691V22.4705H43.7385V35.723H42.285ZM52.5425 35.7515L46.643 22.4705H48.239L53.3405 34.241H52.5995L57.929 22.4705H59.525L53.2835 35.7515H52.5425ZM49.094 41.3375L52.514 34.3265L53.2835 35.7515L50.6615 41.3375H49.094ZM67.6364 36.008C66.3254 36.008 65.1379 35.704 64.0739 35.096C63.0289 34.488 62.2024 33.6615 61.5944 32.6165C60.9864 31.5715 60.6824 30.3935 60.6824 29.0825C60.6824 27.7715 60.9769 26.603 61.5659 25.577C62.1549 24.532 62.9624 23.7055 63.9884 23.0975C65.0334 22.4895 66.1924 22.1855 67.4654 22.1855C68.6814 22.1855 69.7454 22.461 70.6574 23.012C71.5884 23.544 72.3104 24.285 72.8234 25.235C73.3554 26.185 73.6214 27.2775 73.6214 28.5125C73.6214 28.6265 73.6119 28.7785 73.5929 28.9685C73.5739 29.1395 73.5454 29.358 73.5074 29.624H61.7084V28.37H72.6809L72.1964 28.769C72.2344 27.724 72.0634 26.812 71.6834 26.033C71.3034 25.235 70.7524 24.6175 70.0304 24.1805C69.3084 23.7435 68.4439 23.525 67.4369 23.525C66.3919 23.525 65.4704 23.7625 64.6724 24.2375C63.8744 24.6935 63.2474 25.33 62.7914 26.147C62.3544 26.964 62.1359 27.914 62.1359 28.997C62.1359 30.137 62.3639 31.1345 62.8199 31.9895C63.2949 32.8255 63.9504 33.481 64.7864 33.956C65.6224 34.412 66.6009 34.64 67.7219 34.64C68.5769 34.64 69.3654 34.488 70.0874 34.184C70.8284 33.861 71.4459 33.386 71.9399 32.759L72.9089 33.6995C72.3009 34.4215 71.5314 34.9915 70.6004 35.4095C69.6884 35.8085 68.7004 36.008 67.6364 36.008Z' fill='%23050517'/%3E%3Cpath d='M85.1487 51.745V38.4925H86.6022V51.745H85.1487ZM86.6022 43.822L85.8897 43.5655C85.8897 41.8745 86.3172 40.5635 87.1722 39.6325C88.0272 38.6825 89.1482 38.2075 90.5352 38.2075C91.1812 38.2075 91.7797 38.3215 92.3307 38.5495C92.9007 38.7775 93.4232 39.148 93.8982 39.661L92.9292 40.687C92.5682 40.288 92.1787 40.003 91.7607 39.832C91.3427 39.661 90.8487 39.5755 90.2787 39.5755C89.1957 39.5755 88.3122 39.946 87.6282 40.687C86.9442 41.409 86.6022 42.454 86.6022 43.822ZM99.9369 52.03C99.2149 52.03 98.5309 51.935 97.8849 51.745C97.2579 51.536 96.6784 51.251 96.1464 50.89C95.6334 50.529 95.1774 50.111 94.7784 49.636L95.7474 48.667C96.2794 49.37 96.8969 49.8925 97.5999 50.2345C98.3219 50.5575 99.1104 50.719 99.9654 50.719C100.953 50.719 101.732 50.5195 102.302 50.1205C102.872 49.7215 103.157 49.161 103.157 48.439C103.157 47.793 102.977 47.2895 102.616 46.9285C102.255 46.5485 101.78 46.254 101.191 46.045C100.621 45.836 100.013 45.6365 99.3669 45.4465C98.7399 45.2565 98.1319 45.0285 97.5429 44.7625C96.9729 44.4965 96.5074 44.126 96.1464 43.651C95.7854 43.176 95.6049 42.5395 95.6049 41.7415C95.6049 41.0385 95.7854 40.421 96.1464 39.889C96.5074 39.357 97.0109 38.9485 97.6569 38.6635C98.3219 38.3595 99.1009 38.2075 99.9939 38.2075C100.982 38.2075 101.865 38.3785 102.644 38.7205C103.442 39.0625 104.079 39.566 104.554 40.231L103.613 41.2C103.233 40.668 102.72 40.2595 102.074 39.9745C101.428 39.6705 100.706 39.5185 99.9084 39.5185C98.9584 39.5185 98.2364 39.718 97.7424 40.117C97.2484 40.516 97.0014 41.029 97.0014 41.656C97.0014 42.245 97.1819 42.7105 97.5429 43.0525C97.9039 43.3945 98.3694 43.6605 98.9394 43.8505C99.5284 44.0405 100.136 44.2305 100.763 44.4205C101.409 44.5915 102.017 44.8195 102.587 45.1045C103.176 45.3895 103.651 45.779 104.012 46.273C104.373 46.767 104.554 47.4415 104.554 48.2965C104.554 49.4365 104.136 50.3485 103.3 51.0325C102.464 51.6975 101.343 52.03 99.9369 52.03Z' fill='%23050517'/%3E%3Cpath d='M110.073 60.0211L131.186 72.8971L118.329 74.1508L110.667 84.7437L110.073 60.0211Z' fill='%23050517'/%3E%3C/svg%3E%0A"
            alt=""
          />
        </div>
        <div class="text">
          Select all the layers containing the text that you want to replace
        </div>
      </div>
      <div class="selected-fonts"></div>
      <div class="footer selected">
        <div class="footer-left">
          © Bulk Font Replacer —
          <a href="https://resulcelik.com" target="_blank">
            <svg
              width="8"
              height="8"
              viewBox="0 0 7 7"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M0 0V7H3.5V3.5H7V0H0Z" fill="black" />
            </svg>
          </a>
        </div>
        <div class="footer-right">
          <a
            href="https://www.figma.com/community/plugin/1175115698559984660/pagenum"
            target="_blank"
            >Pagenum</a
          >
          —
          <a
            href="https://www.producthunt.com/posts/bulk-font-replacer-for-figma"
            target="_blank"
            >Product Hunt</a
          >
          <a
            href="https://github.com/resul-celik/Bulk-Font-Replacer"
            target="_blank"
            >Github</a
          >
        </div>
      </div>
      <div class="fonts-footer">
        <div class="footer-left">
          <div class="information">
            **If you don’t select a font, It will not be replaced with a new one
          </div>
        </div>
        <div class="footer-right">
          <button id="replace-button">Replace Fonts</button>
        </div>
      </div>
    </div>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        parent.postMessage({ pluginMessage: { type: "ready" } }, "*");
      });

      function icons() {
        const search = `
        <svg class='icon search-icon' viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M17.8107 17.0221L20.9649 20.1764M19.3879 12C19.3879 16.5156 15.7272 20.1763 11.2115 20.1763C6.69584 20.1763 3.03516 16.5156 3.03516 12C3.03516 7.48429 6.69584 3.82361 11.2115 3.82361C15.7272 3.82361 19.3879 7.48429 19.3879 12Z"/>
        </svg>`;

        const close = `
        <svg class='icon close-icon' viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4.36719 4.3678L19.6315 19.6321M19.6315 4.36788L4.36719 19.6322"/>
        </svg>`;

        const chevronDown = `
        <svg class='icon chevron-down' viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21.6094 8.19531L12 17.8047L2.39062 8.19531"/>
        </svg>`;

        const target = `
        <svg class='icon target-icon' viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M11.9999 3V8.28368M21 12H15.7163M11.9999 15.7163V21M8.28368 12H3M19.1186 11.7395C19.1186 15.671 15.9314 18.8582 11.9999 18.8582C8.06835 18.8582 4.88121 15.671 4.88121 11.7395C4.88121 7.80793 8.06835 4.62079 11.9999 4.62079C15.9314 4.62079 19.1186 7.80793 19.1186 11.7395Z"/>
        </svg>`;

        const checkmark = `
        <svg class='icon checkmark-icon' viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21.6496 5.38025L8.41014 18.6197L2.34961 12.5591"/>
        </svg>`;

        return { search, close, chevronDown, target, checkmark };
      }

      let fontSelectors = [];

      /* DROPDOWN */

      function createDropdown(font, allFonts, index) {
        // Create Wrapper
        const dropdown = document.createElement("div");
        dropdown.classList.add("dropdown");
        dropdown.dataset.active = "false";
        dropdown.dataset.value = JSON.stringify({
          family: "None",
          style: "None",
        });

        const { search, close, chevronDown, target, checkmark } = icons();

        // Create Text
        const dropdownText = document.createElement("div");
        dropdownText.classList.add("dropdown-text");
        dropdownText.innerHTML = `<div>Select a font</div>${chevronDown}`;

        dropdownText.onclick = function () {
          const parent = this.closest(".dropdown");
          if (parent.getAttribute("data-active") === "false") {
            parent.querySelector(".dropdown-content").classList.add("active");
            parent.setAttribute("data-active", "true");
          } else {
            parent
              .querySelector(".dropdown-content")
              .classList.remove("active");
            parent.setAttribute("data-active", "false");
          }
        };

        dropdown.appendChild(dropdownText);

        // Create Content
        const dropdownContent = document.createElement("div");
        dropdownContent.classList.add("dropdown-content");

        const contentHead = document.createElement("div");
        contentHead.classList.add("content-head");

        const contentActions = document.createElement("div");
        contentActions.classList.add("content-actions");

        const closeIcon = document.createElement("div");
        closeIcon.classList.add("close-icon");
        closeIcon.innerHTML = close;
        closeIcon.onclick = function () {
          const parent = this.closest(".dropdown");

          parent.querySelector(".dropdown-content").classList.remove("active");
          parent.setAttribute("data-active", "false");
        };

        const dropdownTitle = document.createElement("div");
        dropdownTitle.classList.add("dropdown-title");
        dropdownTitle.innerHTML = `Replacing <b>'${font.family} ${font.style}'</b> with:`;

        contentActions.appendChild(dropdownTitle);
        contentActions.appendChild(closeIcon);

        contentHead.appendChild(contentActions);

        const searchWrapper = document.createElement("div");
        searchWrapper.classList.add("search-wrapper");
        searchWrapper.innerHTML = search;

        const searchInput = document.createElement("input");
        searchInput.classList.add("search");
        searchInput.type = "text";
        searchInput.placeholder = "Search fonts";
        searchInput.onkeyup = function (e) {
          let filteredFonts = [];
          filteredFonts = allFonts.filter(function (ev) {
            return ev.fontName.both.toLowerCase().includes(e.target.value);
          });

          createOptions(filteredFonts);
        };

        searchWrapper.appendChild(searchInput);
        contentHead.appendChild(searchWrapper);
        dropdownContent.appendChild(contentHead);

        const options = document.createElement("div");
        options.classList.add("options");

        /* Create Options */

        function createOptions(allFonts) {
          options.innerHTML = "";

          function handleOptionClicks(e) {
            const currentOption = e.target;
            const wrapper = currentOption.closest(".dropdown");
            const dtText = wrapper.querySelector(".dropdown-text");

            let selectedState = currentOption.dataset.value;

            let optionValues = JSON.parse(selectedState);

            if (optionValues.family === "None") {
              dtText.classList.remove("dropdown-selected");
              dtText.innerHTML = `<div>Select a font</div>${chevronDown}`;
            } else {
              dtText.classList.add("dropdown-selected");
              dtText.innerHTML = `
              <div class="font-name">${optionValues.family}</div>
              <div class="font-style">${optionValues.style}</div>
              ${chevronDown}`;
            }

            wrapper.querySelectorAll(".option").forEach((el) => {
              el.classList.remove("current-option");
            });
            currentOption.classList.add("current-option");

            wrapper
              .querySelector(".dropdown-content")
              .classList.remove("active");
            wrapper.setAttribute("data-active", "false");

            wrapper.dataset.value = selectedState;
            // Update the corresponding fontSelector value
            fontSelectors[index].value = selectedState;
          }

          const option = document.createElement("div");
          option.classList.add("option", "first-option", "current-option");
          option.dataset.value = JSON.stringify({
            family: "None",
            style: "None",
          });

          option.innerHTML = `
            <div class='new-font'>
              <div class='font-name'>-- Select a font</div>
            </div>
            ${checkmark}
          `;

          option.onclick = (e) => handleOptionClicks(e);

          options.appendChild(option);

          allFonts.forEach((fontObj) => {
            if (
              fontObj.fontName.family.substr(0, 1) !== "." &&
              fontObj.fontName.family.substr(0, 1) !== "?"
            ) {
              const option = document.createElement("div");
              option.classList.add("option");
              option.dataset.value = JSON.stringify({
                family: fontObj.fontName.family,
                style: fontObj.fontName.style,
              });
              option.innerHTML = `
              <div class='new-font'>
                <div class='font-name'>${fontObj.fontName.family}</div>
                <div class='font-style'>${fontObj.fontName.style}</div>
              </div>
              ${checkmark}`;
              option.onclick = (e) => handleOptionClicks(e);

              options.appendChild(option);
            }
          });
        }

        createOptions(allFonts);
        dropdownContent.appendChild(options);
        dropdown.appendChild(dropdownContent);
        return dropdown;
      }

      /* FONT ROW */
      function createFontRow(font, allFonts, index) {
        const { target } = icons();
        const fontRow = document.createElement("div");
        fontRow.classList = ["selected-font"];
        fontRow.dataset.id = font.nodeID;

        const currentFont = document.createElement("div");
        currentFont.classList.add("current-font");
        currentFont.innerHTML = `
        <div class='go-to' onclick='goToLayer(this)'>${target}</div>
        <div class='font-name'>${font.family} </div>
        <div class='font-style'>${font.style}</div>
        `;
        fontRow.appendChild(currentFont);

        const arrowWrapper = document.createElement("div");
        arrowWrapper.classList.add("arrow-wrapper");
        arrowWrapper.innerHTML = '<div class="arrow"></div>';
        fontRow.appendChild(arrowWrapper);

        const dropdown = createDropdown(font, allFonts, index);

        fontRow.appendChild(dropdown);

        document.querySelector(".selected-fonts").appendChild(fontRow);

        return {
          family: font.family,
          style: font.style,
          value: dropdown.dataset.value,
          nodeID: fontRow.dataset.id,
        };
      }

      // Handle messages from the plugin code
      window.onmessage = (event) => {
        const message = event.data.pluginMessage;
        let fontsUsed, allFonts;
        const container = document.querySelector(".container");
        const body = document.querySelector(".body");
        const footer = document.querySelector(".footer");
        const fontsFooter = document.querySelector(".fonts-footer");
        const fontContainer = document.querySelector(".selected-fonts");

        if (message.fontsUsed.length === 0) {
          body.classList.add("selected");
          footer.classList.add("selected");
          fontsFooter.classList.remove("selected");
          fontContainer.classList.remove("selected");
        } else {
          body.classList.remove("selected");
          footer.classList.remove("selected");
          fontsFooter.classList.add("selected");
          fontContainer.classList.add("selected");

          fontsUsed = message.fontsUsed;
          allFonts = message.allFonts;

          if (message.type === "load-fonts") {
            fontContainer.innerHTML = "";
            fontSelectors = fontsUsed.map((font, index) =>
              createFontRow(font, allFonts, index)
            );
          }

          if (message.type === "selected-fonts") {
            fontContainer.innerHTML = "";
            fontSelectors = fontsUsed.map((font, index) =>
              createFontRow(font, allFonts, index)
            );
          }
        }
      };

      function goToLayer(e) {
        parent.postMessage(
          {
            pluginMessage: {
              type: "go-to",
              nodeID: e.closest(".selected-font").dataset.id,
            },
          },
          "*"
        );
      }

      // Handle the replace button click
      document.getElementById("replace-button").onclick = () => {
        parent.postMessage(
          {
            pluginMessage: {
              type: "replace-fonts",
              allFonts: fontSelectors,
            },
          },
          "*"
        );
      };
    </script>
  </body>
</html>
